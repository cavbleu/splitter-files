### Программа для извлечения файлов из бинарных данных

#### 1. Назначение программы
Программа предназначена для:
- Анализа бинарных файлов (включая поврежденные)
- Поиска и извлечения вложенных файлов различных форматов
- Восстановления структуры найденных файлов
- Сохранения извлеченных файлов с метаинформацией

#### 2. Поддерживаемые форматы файлов
Программа распознает и корректно обрабатывает:
- **Документы**:
  - Microsoft Office (DOC/DOCX, XLS/XLSX, PPT/PPTX)
  - PDF (Portable Document Format)
  - RTF (Rich Text Format)
  - ODT (OpenDocument Text)
- **Архивы**: ZIP
- **Изображения**: JPEG/JPG
- **Веб-форматы**: HTML
- **Другие**: бинарные данные с известными сигнатурами

#### 3. Алгоритм работы программы

##### Этап 1: Подготовка и инициализация
1. Чтение входного файла целиком в память
2. Создание рабочего каталога для выходных файлов
3. Инициализация пула worker-потоков (по умолчанию = количеству CPU ядер)

##### Этап 2: Анализ данных
1. **Сканирование на сигнатуры**:
   - Последовательное чтение бинарных данных
   - Поиск "магических чисел" (magic numbers) - уникальных последовательностей байт, характерных для разных форматов
   - Использование расширенной проверки сигнатур:
     ```go
     var fileSignatures = []FileSignature{
         {Extension: "pdf", MagicNumber: []byte{0x25, 0x50, 0x44, 0x46}, Validator: validatePdf},
         // ... другие форматы
     }
     ```

2. **Валидация найденных файлов**:
   - Для каждого потенциального файла вызывается соответствующая функция-валидатор
   - Проверка целостности структуры файла
   - Дополнительные проверки для специфических форматов:
     - Для PDF: проверка xref таблицы, маркеров начала/конца
     - Для Office: анализ структуры OOXML
     - Для JPEG: поиск маркеров начала/конца изображения

##### Этап 3: Извлечение файлов
1. **Определение границ файла**:
   - Для каждого формата свой алгоритм:
     - PDF: поиск %%EOF + проверка xref
     - JPEG: поиск маркера FF D9
     - ZIP/Office: поиск сигнатуры PK\x03\x04 + центрального каталога

2. **Специальная обработка сложных случаев**:
   - Вложенные файлы (например, изображения в PDF)
   - Фрагментированные/поврежденные файлы
   - Перекрывающиеся файлы

3. **Сохранение извлеченных данных**:
   - Генерация уникальных имен файлов (file_0001.pdf, file_0002.jpg и т.д.)
   - Запись в выходной каталог
   - Сохранение метаинформации:
     - Позиция в исходном файле
     - Размер
     - Дополнительные атрибуты (для Office: версия, макросы, шифрование)

##### Этап 4: Постобработка и отчетность
1. **Анализ покрытия**:
   - Построение карты обработанных данных
   - Выявление непокрытых участков
   - Обнаружение потенциально поврежденных областей

2. **Генерация отчетов**:
   - Статистика по извлеченным файлам
   - Предупреждения о проблемах
   - Визуализация структуры исходных данных

#### 4. Особенности обработки ключевых форматов

**PDF файлы**:
1. Поиск строго по началу файла (%PDF-)
2. Обязательная проверка:
   - Наличие xref таблицы
   - Корректный маркер конца (%%EOF)
   - Минимальный размер (1KB)
3. Игнорирование встроенных изображений
4. Корректная обработка переводов строк после %%EOF

**Офисные документы**:
1. Детектирование типа (Word/Excel/PowerPoint)
2. Анализ метаданных:
   - Версия документа
   - Наличие макросов (VBAProject)
   - Признаки шифрования
3. Проверка целостности OOXML структуры

**JPEG изображения**:
1. Точное определение границ по маркерам
2. Проверка валидности структуры
3. Корректная обработка progressive JPEG

#### 5. Многопоточная обработка

Реализация через worker-потоки:
```go
func worker(id int, jobs <-chan FileChunk, results chan<- ExtractionResult, ...) {
    for chunk := range jobs {
        // Обработка фрагмента данных
        results <- ExtractionResult{...}
    }
}
```

Особенности:
- Приоритетная обработка Office-документов
- Балансировка нагрузки между потоками
- Асинхронная передача результатов

#### 6. Система валидации файлов

Для каждого формата реализованы специализированные валидаторы:
```go
func validatePdf(data []byte) bool {
    // Проверка обязательных структур PDF
    if !bytes.Contains(data, []byte("xref")) {
        return false
    }
    // Дополнительные проверки
    // ...
}
```

#### 7. Восстановление поврежденных файлов

Алгоритмы восстановления:
1. Поиск ближайшего валидного конца файла
2. Анализ структуры заголовков
3. Эвристические методы для частично поврежденных данных

#### 8. Генерация отчетов

Пример вывода статистики:
```
=== Detailed Statistics ===
Input file size:       2,145,678 bytes
Extracted files:       23
Total extracted size:  2,010,432 bytes
Data coverage:         93.7%

File types distribution:
- PDF Document:        5
- Word Document:       3
- JPEG Image:          10
- ZIP Archive:         2
- Other:               3

Uncovered areas (3):
- 1,250,000 - 1,251,200 (1,200 bytes)
- 1,980,000 - 2,000,000 (20,000 bytes)
```

#### 9. Особые случаи обработки

1. **Вложенные файлы**:
   - Изображения в PDF не извлекаются как отдельные файлы
   - Архивы (ZIP) обрабатываются рекурсивно

2. **Поврежденные данные**:
   - Восстановление максимально возможного объема данных
   - Четкое определение границ валидных фрагментов

3. **Дубликаты и перекрытия**:
   - Детектирование перекрывающихся файлов
   - Учет перекрытий в статистике

#### 10. Требования к входным данным

1. Поддерживаются:
   - Бинарные файлы любого размера
   - Частично поврежденные данные
   - Файлы с вложенными структурами

2. Ограничения:
   - Минимальный размер извлекаемого файла: 2KB
   - Требуется наличие валидных сигнатур

Программа обеспечивает надежное извлечение файлов даже из поврежденных данных, с подробной статистикой и информацией о процессе обработки. Многопоточная архитектура позволяет эффективно работать с большими файлами, сохраняя высокую точность распознавания форматов.

### Ограничения программы (что она **не** может сделать):

---

#### 1. **Не поддерживает все форматы файлов**
   - Работает только с заранее заданными форматами:  
     `PDF, DOC/DOCX, XLS/XLSX, PPT/PPTX, JPEG, ZIP, RTF, ODT, HTML`.
   - **Не восстановит**:  
     - Видео (MP4, AVI и др.)  
     - Аудио (MP3, WAV)  
     - Специфичные форматы (CAD, базы данных, виртуальные диски и т.д.).

---

#### 2. **Не расшифровывает файлы**
   - Может определить, что файл зашифрован (например, запароленный PDF или Word),  
     но **не может**:
     - Подобрать пароль.
     - Расшифровать данные без ключа.

---

#### 3. **Не восстанавливает файловую систему**
   - Программа анализирует "сырые" бинарные данные, но:  
     - **Не** восстанавливает структуру папок.  
     - **Не** восстанавливает оригинальные имена файлов (все файлы получают имена вида `file_0001.pdf`).  
     - **Не** работает с удаленными файлами на дисках (для этого нужны специализированные утилиты вроде `PhotoRec`).

---

#### 4. **Не исправляет поврежденные данные внутри файлов**
   - Если файл частично перезаписан (например, половина JPEG отсутствует), программа:  
     - Извлечет его, но он может быть **нечитаемым**.  
     - **Не** "починит" внутреннюю структуру (например, битые таблицы в Excel).

---

#### 5. **Не гарантирует 100% восстановление**
   - Эффективность зависит от:  
     - Степени повреждения данных.  
     - Наличия фрагментов файлов в анализируемом дампе.  
   - Может пропускать файлы, если их сигнатуры повреждены.

---

#### 6. **Не работает с сетевыми/живыми системами**
   - Только анализ **статичных файлов** (например, дампов памяти или образов дисков).  
   - **Не** может:  
     - Сканировать жесткий диск напрямую.  
     - Восстанавливать файлы "на лету" с работающей системы.

---

#### 7. **Не поддерживает многотомные архивы**
   - Если ZIP-архив разбит на части (`part1.zip`, `part2.zip`), программа:  
     - Извлечет каждый том как отдельный файл,  
     - Но **не** объединит их автоматически.

---

### Когда программа **бесполезна**?
1. Файлы перезаписаны нулями/случайными данными (нет сигнатур).  
2. Данные зашифрованы **на уровне файловой системы** (BitLocker, VeraCrypt).  
3. Требуется восстановление метаданных (дата создания, права доступа).  

Для таких задач потребуются другие инструменты (например, `TestDisk` для ФС или `John the Ripper` для подбора паролей).